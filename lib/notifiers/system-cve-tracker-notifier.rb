# encoding: utf-8
require_relative '../tracker-client'

class SystemCVETrackerNotifier
  def self.notify!(cves, related_to_stacks)
    return if !related_to_stacks || cves.empty?
    cve_titles = cves.map { |c| c[:title] }
    story_name = "address: #{cve_titles.join(', ')}"
    story_description = cves.map { |cve| cve[:description] }.join("\n\n--------\n\n")
    labels = %w(pm-only)

    tracker_client = TrackerClient.new(
      ENV['TRACKER_API_TOKEN'],
      ENV['TRACKER_PROJECT_ID'],
      ENV['TRACKER_REQUESTER_ID'].to_i
    )

    tracker_client.post_to_tracker(name: story_name, description: story_description, labels: labels)
  end
end
