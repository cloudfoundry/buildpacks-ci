# encoding: utf-8
require_relative '../slack-client'

class CVESlackNotifier
  def self.notify!(cves, contents, stack)
    return if contents[:category].match(/-unrelated$/) != nil || cves.empty?
    slack_output = "There are *#{cves.length}* new CVEs for #{stack}:\n"

    cves.each do |cve|
      slack_output << "- #{cve['title']}*\n"
    end

    slack_client = SlackClient.new(
        ENV.fetch('SLACK_WEBHOOK'),
        ENV.fetch('SLACK_CHANNEL'),
        'dependency-notifier'
    )
    slack_client.post_to_slack slack_output
  end
end
