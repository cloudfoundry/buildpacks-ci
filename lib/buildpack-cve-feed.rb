# encoding: utf-8
# require 'rss'
require 'nokogiri'
require 'open-uri'
class BuildpackCVEFeed
  def self.run(language)
    return [] unless feed_uri[language]
    parse(language)
  end

  private

  def self.parse(language)
    case language
    when 'ruby'
      ul = feed(language).css('ul')
      list = ul[0].css('li > a')
      list.map do |li|
        {
          'title' => li.text,
          'description' => 'http://www.ruby-lang.org' + li['href'],
          'raw_description' => ''
        }
      end
    end
  end

  def self.feed_uri
    {
      'ruby' => 'http://www.ruby-lang.org/en/security'
    }
  end

  def self.feed(language)
    Nokogiri::HTML(open(feed_uri[language]))
  end
end
