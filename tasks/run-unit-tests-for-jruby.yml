---
platform: linux
image_resource:
  type: docker-image
  source:
    repository: cloudfoundry/cflinuxfs2
inputs:
  - name: build-tar
run:
  path: bash
  args: ["-c",
    "apt-get update &&
    apt-get install -y openjdk-7-jdk maven ant &&
    tar xzf build-tar/binary-builder-source.tgz -C /tmp &&
    cd /tmp/x86_64-linux-gnu/ports/jruby/*/*/ &&
    export JAVA_OPTS='-XX:+TieredCompilation -XX:TieredStopAtLevel=1' &&
    export MALLOC_ARENA_MAX=2 &&
    export PHASE='-Ptest' &&
    mvn -Pbootstrap clean install -Dinvoker.skip -Dmaven.test.skip &&
    mvn install -Dinvoker.skip=false $PHASE"]
